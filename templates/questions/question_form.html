{% extends "base.html" %}

{% block title %}Submit Â· Philosofriends{% endblock %}

{% block content %}
    <section class="hn-form">
        <h1>Submit a post</h1>
        <form method="post">
            {% csrf_token %}
            <div class="hn-field hn-submit-type">
                <label>Post type</label>
                <div class="hn-toggle">
                    <label>
                        <input type="radio" name="post_type" value="question" {% if not form.link.value %}checked{% endif %}>
                        Question
                    </label>
                    <label>
                        <input type="radio" name="post_type" value="link" {% if form.link.value %}checked{% endif %}>
                        Link
                    </label>
                </div>
            </div>
            <div class="hn-field" id="title-field">
                <label for="id_title">Question / Title</label>
                {{ form.title }}
                {% if form.title.errors %}
                    <div class="hn-error">{{ form.title.errors }}</div>
                {% endif %}
            </div>
            <div class="hn-field hn-link-field" id="link-field">
                <label for="id_link">Link URL</label>
                {{ form.link }}
                {% if form.link.errors %}
                    <div class="hn-error">{{ form.link.errors }}</div>
                {% endif %}
            </div>
            <div class="hn-field" id="body-field">
                <label for="id_body">Context (optional)</label>
                {{ form.body }}
                {% if form.body.errors %}
                    <div class="hn-error">{{ form.body.errors }}</div>
                {% endif %}
            </div>
            <button class="hn-button" type="submit">Submit</button>
        </form>
    </section>

    <script>
        (() => {
            const linkField = document.getElementById('link-field');
            const bodyField = document.getElementById('body-field');
            const titleField = document.getElementById('title-field');
            const typeInputs = document.querySelectorAll('input[name="post_type"]');

            const syncFields = () => {
                const selected = document.querySelector('input[name="post_type"]:checked');
                const isLink = selected && selected.value === 'link';
                if (linkField) linkField.hidden = !isLink;
                if (bodyField) bodyField.hidden = isLink;
                if (titleField) titleField.hidden = isLink;
            };

            typeInputs.forEach((input) => input.addEventListener('change', syncFields));
            syncFields();
        })();
    </script>
{% endblock %}
