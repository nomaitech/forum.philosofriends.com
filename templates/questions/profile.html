{% extends "base.html" %}

{% block title %}{{ profile_user.username }} · Philosofriends{% endblock %}

{% block content %}
    <section class="hn-profile">
        <h1 class="hn-profile-title">
            {% if profile_user.profile.is_vip %}
                <span class="hn-user--vip">{{ profile_user.username }}</span>
            {% else %}
                {{ profile_user.username }}
            {% endif %}
            {% if user.is_authenticated and user.is_superuser %}
                {% if not impersonation_user or impersonation_user.id != profile_user.id %}
                    <form method="post" action="{% url 'impersonate_start' %}" class="hn-inline-admin-form">
                        {% csrf_token %}
                        <input type="hidden" name="user_id" value="{{ profile_user.id }}">
                        <input type="hidden" name="next" value="{{ request.get_full_path }}">
                        <button class="hn-admin-post-as" type="submit">post as {{ profile_user.username }}</button>
                    </form>
                {% endif %}
            {% endif %}
        </h1>
        <p class="hn-muted">Posts by {{ profile_user.username }}</p>
        {% if is_own_profile %}
            <section class="hn-profile-settings">
                <h2>Profile settings</h2>
                <form method="post" class="hn-form">
                    {% csrf_token %}
                    <div class="hn-field">
                        <label for="{{ settings_form.email.id_for_label }}">Email</label>
                        {{ settings_form.email }}
                        {% if settings_form.email.errors %}
                            <div class="hn-error">{{ settings_form.email.errors }}</div>
                        {% endif %}
                    </div>
                    <div class="hn-field">
                        <span>Email notifications</span>
                        <label>{{ settings_form.notify_new_posts }} New posts</label>
                        <label>{{ settings_form.notify_replies_to_comments }} New replies to your comments</label>
                        <label>{{ settings_form.notify_replies_to_posts }} New replies to your posts</label>
                    </div>
                    <button class="hn-button" type="submit">Save settings</button>
                </form>
            </section>
        {% endif %}
        {% if user.is_authenticated and user.is_superuser and impersonation_user and impersonation_user.id == profile_user.id %}
            <p class="hn-muted">Currently posting as this user.</p>
            <form method="post" action="{% url 'impersonate_stop' %}">
                {% csrf_token %}
                <input type="hidden" name="next" value="{{ request.get_full_path }}">
                <button class="hn-button" type="submit">Stop impersonating</button>
            </form>
        {% endif %}
    </section>

    {% if questions %}
        <ol class="hn-list">
            {% for question in questions %}
                <li class="hn-item{% if question.pinned %} hn-item--pinned{% endif %}">
                    <div class="hn-item-header">
                        <div class="hn-item-content">
                            <div class="hn-item-title">
                                {% if question.link %}
                                    <a href="{{ question.link }}" rel="noopener noreferrer" target="_blank">
                                        {{ question.title }}
                                        <span class="hn-link-icon" aria-hidden="true">
                                            <svg viewBox="0 0 16 16" focusable="false">
                                                <path d="M10.5 2.5h3v3" />
                                                <path d="M9.2 6.8L13.5 2.5" />
                                                <path d="M7.5 3.5H3.5v9h9v-4" />
                                            </svg>
                                        </span>
                                    </a>
                                {% else %}
                                    <a href="{% url 'question_detail_slug' question.slug %}">{{ question.title }}</a>
                                {% endif %}
                            </div>
                            <div class="hn-item-meta">
                                {{ question.score|default:0 }} point{{ question.score|pluralize }} · {{ question.created_at|date:"M j, Y" }}
                                · <a href="{% url 'question_detail_slug' question.slug %}">{{ question.comments_count|default:0 }} comments</a>
                                {% if question.pinned %}
                                    · <span class="hn-pin">pinned</span>
                                {% endif %}
                                {% if question.link %}
                                    · <a href="{{ question.link }}" rel="noopener noreferrer" target="_blank">source</a>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                </li>
            {% endfor %}
        </ol>
    {% else %}
        <p class="hn-body hn-muted">No posts yet.</p>
    {% endif %}
{% endblock %}
