<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>{% block title %}Philosofriends{% endblock %}</title>
    {% block meta %}{% endblock %}
    <link rel="icon" href="/static/favicon.svg" type="image/svg+xml">
    <link rel="stylesheet" href="/static/css/hn.css">
</head>
<body>
    <header class="hn-header">
        <div class="hn-bar">
            <a class="hn-logo" href="/">Φ</a>
            <div class="hn-title">
                <a href="/">Philosofriends</a>
            </div>
            <nav class="hn-nav hn-nav-left">
                <a class="hn-submit" href="/?sort=new">latest</a>
                <span class="hn-sep">|</span>
                <a class="hn-submit" href="/submit/">submit</a>
            </nav>
            <div class="hn-spacer"></div>
            <nav class="hn-nav hn-nav-right">
                {% if user.is_authenticated %}
                    <a class="hn-user" href="{% url 'profile_detail' user.username %}">{{ user.username }}</a>
                    {% if impersonation_user %}
                        <span class="hn-sep">|</span>
                        <span>posting as {{ impersonation_user.username }}</span>
                    {% endif %}
                    <span class="hn-sep">|</span>
                    <a href="/accounts/logout/">logout</a>
                {% else %}
                    <a href="/accounts/login/">login</a>
                    <span class="hn-sep">|</span>
                    <a href="/signup/">signup</a>
                {% endif %}
            </nav>
        </div>
    </header>
    {% if impersonation_user %}
        <div class="hn-impersonation-banner">
            You are posting as <strong>{{ impersonation_user.username }}</strong>.
            <form method="post" action="{% url 'impersonate_stop' %}">
                {% csrf_token %}
                <input type="hidden" name="next" value="{{ request.get_full_path }}">
                <button type="submit">Stop impersonating</button>
            </form>
        </div>
    {% endif %}

    <main class="hn-main">
        {% block content %}{% endblock %}
    </main>

    <footer class="hn-footer">
        <div>
            Philosofriends is a place for short, sincere questions about meaning, mind, and ethics.
            · <a href="https://luma.com/philosofriends" rel="noopener noreferrer" target="_blank">Events calendar</a>
            {% if user.is_authenticated %}
            · <a href="{% url 'account_delete' %}">Delete account</a>
            {% endif %}
            · <button class="hn-footer-toggle" type="button" id="theme-toggle">dark mode</button>
        </div>
    </footer>
    <script>
        (() => {
            const root = document.documentElement;
            const toggle = document.getElementById('theme-toggle');
            const storedTheme = localStorage.getItem('theme');
            if (storedTheme === 'dark') {
                root.setAttribute('data-theme', 'dark');
            }
            const syncLabel = () => {
                const isDark = root.getAttribute('data-theme') === 'dark';
                if (toggle) toggle.textContent = isDark ? 'light mode' : 'dark mode';
            };
            syncLabel();
            if (toggle) {
                toggle.addEventListener('click', () => {
                    const isDark = root.getAttribute('data-theme') === 'dark';
                    if (isDark) {
                        root.removeAttribute('data-theme');
                        localStorage.setItem('theme', 'light');
                    } else {
                        root.setAttribute('data-theme', 'dark');
                        localStorage.setItem('theme', 'dark');
                    }
                    syncLabel();
                });
            }
        })();
    </script>
</body>
</html>
